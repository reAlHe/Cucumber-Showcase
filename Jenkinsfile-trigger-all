pipeline {
    agent any
    environment {
        FLAG_FILE = "trigger-all-tests.flag"
    }
    triggers {
        cron('H/2 * * * *') // Runs at 2 AM every night
    }
    stages {
        stage('Trigger nightly test for all tags') {
            steps {
                copyArtifacts projectName: 'continuous-build', filter: FLAG_FILE
                script {
                    if (fileExists(FLAG_FILE)) {
                        echo 'Trigger pipeline for all tests'
                        build job: 'extended-test-suite', wait: true
                        sh 'rm FLAG_FILE'
                    }
                    else {
                        echo 'No changes, nothing to do'
                    }
                }
            }
        }
    }
}